___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "displayName": "Algolia Search Insights",
  "description": "Library for detecting front-end Algolia search metrics.",
  "type": "TAG",
  "version": 1,
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "containerContexts": ["WEB"],
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "Algolia",
    "id": "brand_algolia"
  }
}


___TEMPLATE_PARAMETERS___

[
  {
    "displayName": "Method",
    "name": "method",
    "type": "SELECT",
    "simpleValueType": true,
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "Initialization",
        "value": "init"
      },
      {
        "displayValue": "Set Authenticated User Token",
        "value": "setAuthenticatedUserToken"
      },
      {
        "displayValue": "Clicked Object IDs",
        "value": "clickedObjectIDs"
      },
      {
        "displayValue": "Clicked Object IDs After Search",
        "value": "clickedObjectIDsAfterSearch"
      },
      {
        "displayValue": "Clicked Filters",
        "value": "clickedFilters"
      },
      {
        "displayValue": "Converted Object IDs",
        "value": "convertedObjectIDs"
      },
      {
        "displayValue": "Converted Objects IDs After Search",
        "value": "convertedObjectIDsAfterSearch"
      },
      {
        "displayValue": "Converted Filters",
        "value": "convertedFilters"
      },
      {
        "displayValue": "Viewed Object IDs",
        "value": "viewedObjectIDs"
      },
      {
        "displayValue": "Viewed Filters",
        "value": "viewedFilters"
      }
    ]
  },
  {
    "displayName": "Method Details",
    "name": "MethodLabelsGroup",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "init"
          }
        ],
        "displayName": "Initializes the Algolia Search Insights library.",
        "name": "labelInit",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "setAuthenticatedUserToken"
          }
        ],
        "displayName": "Set the authenticated user token for all subsequent events sent to the Algolia Insights API. Use this method to automatically send the `authenticatedUserToken` with every event.",
        "name": "labelSetAuthenticatedUserToken",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedObjectIDsAfterSearch"
          }
        ],
        "displayName": "Sends a click event to capture the clicked items related to a query.",
        "name": "labelClickedObjectIDsAfterSearch",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedObjectIDs"
          }
        ],
        "displayName": "Sends a click event to capture the clicked items.",
        "name": "labelClickedObjectIDs",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedFilters"
          }
        ],
        "displayName": "Sends a click event to capture the clicked filters.",
        "name": "labelClickedFilters",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          }
        ],
        "displayName": "Sends a conversion event to capture the clicked items related to a search.",
        "name": "labelConvertedObjectIDsAfterSearch",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDs"
          }
        ],
        "displayName": "Sends a conversion event to capture the clicked items.",
        "name": "labelConvertedObjectIDs",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedFilters"
          }
        ],
        "displayName": "Sends a conversation event to capture the filters a user uses when converting.",
        "name": "labelConvertedFilters",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "viewedObjectIDs"
          }
        ],
        "displayName": "Sends a view event to capture the items.",
        "name": "labelViewedObjectIDs",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "viewedFilters"
          }
        ],
        "displayName": "Sends a view event to capture the filters.",
        "name": "labelViewedFilters",
        "type": "LABEL"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "init"
      }
    ],
    "name": "InitOptions",
    "displayName": "Init Options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "App ID",
        "help": "The identifier of your Algolia application.",
        "name": "appId",
        "type": "TEXT",
        "simpleValueType": true
      },
      {
        "displayName": "API Key",
        "help": "The search API key of your Algolia application.",
        "name": "apiKey",
        "type": "TEXT",
        "simpleValueType": true
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "init"
      }
    ],
    "displayName": "Advanced init options",
    "name": "AdvancedInitOptions",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Authenticated User Token",
        "name": "init_authenticatedUserToken",
        "help": "Optional. Pseudonymous identifier for authenticated users. Never include personally identifiable information in user tokens.",
        "type": "TEXT",
        "simpleValueType": true
      },
      {
        "displayName": "Opt Out User",
        "name": "userHasOptedOut",
        "help": "Whether to exclude users from analytics.",
        "type": "SELECT",
        "macrosInSelect": true,
        "simpleValueType": true,
        "notSetText": "",
        "selectItems": [
          {
            "displayValue": "False",
            "value": false
          },
          {
            "displayValue": "True",
            "value": true
          }
        ]
      },
      {
        "displayName": "Region",
        "name": "region",
        "help": "The DNS server to target.",
        "type": "SELECT",
        "simpleValueType": true,
        "macrosInSelect": true,
        "notSetText": "",
        "selectItems": [
          {
            "displayValue": "de",
            "value": "de"
          },
          {
            "displayValue": "us",
            "value": "us"
          }
        ]
      },
      {
        "displayName": "Use Cookie",
        "name": "useCookie",
        "help": "Whether to use cookies. True by default. When set to false, make sure to define a user token, manually persist it and retrieve it from the browser",
        "type": "SELECT",
        "macrosInSelect": true,
        "simpleValueType": true,
        "notSetText": "",
        "selectItems": [
          {
            "displayValue": "False",
            "value": false
          },
          {
            "displayValue": "True",
            "value": true
          }
        ]
      },
      {
        "displayName": "Cookie Duration",
        "name": "cookieDuration",
        "help": "The cookie duration in milliseconds (default to `15552000000`, 6 months).",
        "type": "TEXT",
        "simpleValueType": true
      },
      {
        "displayName": "User Token",
        "name": "initialUserToken",
        "help": "Set an initial user identifier applied to subsequent events.",
        "type": "TEXT",
        "simpleValueType": true
      },
      {
        "displayName": "Use IIFE bundle",
        "name": "useIIFE",
        "help": "If your website has RequireJS, use IIFE bundle of search-insights to avoid any issue. (False by default)",
        "type": "SELECT",
        "macrosInSelect": true,
        "simpleValueType": true,
        "notSetText": "",
        "selectItems": [
          {
            "displayValue": "False",
            "value": false
          },
          {
            "displayValue": "True",
            "value": true
          }
        ]
      },
      {
        "displayName": "Host",
        "name": "host",
        "help": "Optional. URL to route requests through before they are forwarded to Algolia.",
        "type": "TEXT",
        "simpleValueType": true
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "setAuthenticatedUserToken"
      }
    ],
    "name": "SetAuthenticatedUserTokenOptions",
    "displayName": "Set Authenticated User Options",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Authenticated User Token",
        "help": "Pseudonymous identifier for authenticated users. Never include personally identifiable information in user tokens.",
        "name": "setAuthenticatedUserToken_token",
        "type": "TEXT",
        "simpleValueType": true
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "clickedObjectIDs"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "clickedObjectIDsAfterSearch"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "clickedFilters"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "convertedObjectIDs"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "convertedObjectIDsAfterSearch"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "convertedFilters"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "viewedObjectIDs"
      },
      {
        "paramName": "method",
        "type": "EQUALS",
        "paramValue": "viewedFilters"
      }
    ],
    "name": "EventOptions",
    "displayName": "Event Options",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "User Token",
        "name": "userToken",
        "help": "The identifier of the user.",
        "type": "TEXT",
        "simpleValueType": true
      },
      {
        "displayName": "Authenticated User Token",
        "name": "authenticatedUserToken",
        "help": "Optional. Pseudonymous identifier for authenticated users. Never include personally identifiable information in user tokens.",
        "type": "TEXT",
        "simpleValueType": true
      },
      {
        "help": "The name of the event.",
        "displayName": "Event Name",
        "simpleValueType": true,
        "name": "eventName",
        "type": "TEXT"
      },
      {
        "help": "The specific type of conversion event. Set to 'None' for conversion events that do not have a subtype.",
        "displayName": "Conversion Event Subtype",
        "simpleValueType": true,
        "name": "eventSubtype",
        "type": "SELECT",
        "selectItems": [
          {
            "displayValue": "None",
            "value": ""
          },
          {
            "displayValue": "Add to cart",
            "value": "addToCart"
          },
          {
            "displayValue": "Purchase",
            "value": "purchase"
          }
        ],
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDs"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedFilters"
          }
        ]
      },
      {
        "displayName": "Index",
        "name": "index",
        "help": "The name of the index related to the event.",
        "simpleValueType": true,
        "type": "TEXT"
      },
      {
        "displayName": "Object IDs",
        "name": "objectIDs",
        "help": "The list of object IDs separated by commas (maximum of 20).",
        "simpleValueType": true,
        "type": "TEXT",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedObjectIDs"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDs"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "viewedObjectIDs"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "objectData",
        "displayName": "Object Data",
        "help": "A list of <a href=\"https://www.algolia.com/doc/api-reference/api-methods/added-to-cart-object-ids/#method-param-objectdata-2\">data</a> containing additional information about associated objects (maximum of 20).",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDs"
          }
        ]
      },
      {
        "displayName": "Query ID",
        "name": "queryID",
        "help": "The `queryID` of the search sent from Algolia (<a href=\"https://www.algolia.com/doc/api-reference/api-parameters/clickAnalytics/\">`clickAnalytics`</a> needs to be set)",
        "simpleValueType": true,
        "type": "TEXT",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          }
        ]
      },
      {
        "displayName": "Positions",
        "name": "positions",
        "help": "The list of the absolute positions of the element that was clicked (1-based and _not_ 0-based). They must be separated by commas and limited to 20.",
        "simpleValueType": true,
        "type": "TEXT",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedObjectIDsAfterSearch"
          }
        ]
      },
      {
        "displayName": "Filters",
        "name": "filters",
        "help": "The list of filters that was clicked as '${attr}${op}${value}'' (e.g. brand:Apple). They must be separated by commas and limited to 20.",
        "simpleValueType": true,
        "type": "TEXT",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "clickedFilters"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedFilters"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "viewedFilters"
          }
        ]
      },
      {
        "help": "The total value of the add to cart or purchase event, e.g. 1.234. If provided, currency must be specified as well.",
        "displayName": "Value",
        "simpleValueType": true,
        "type": "TEXT",
        "name": "value",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDs"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedFilters"
          }
        ]
      },
      {
        "help": "The currency associated with the value, e.g. USD.",
        "displayName": "Currency",
        "simpleValueType": true,
        "type": "TEXT",
        "name": "currency",
        "enablingConditions": [
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDs"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedObjectIDsAfterSearch"
          },
          {
            "paramName": "method",
            "type": "EQUALS",
            "paramValue": "convertedFilters"
          }
        ]
      }
    ]
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aa"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aa.queue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "AlgoliaAnalyticsObject"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/npm/search-insights*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const createArgumentsQueue = require('createArgumentsQueue');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const setInWindow = require('setInWindow');
const copyFromWindow = require('copyFromWindow');
const makeInteger = require('makeInteger');
const getType = require('getType');
const Math = require('Math');
const Object = require('Object');
const INSIGHTS_OBJECT_NAME = 'AlgoliaAnalyticsObject';
const INSIGHTS_LIBRARY_URL = 'https://cdn.jsdelivr.net/npm/search-insights@2.17.3';
const MAX_OBJECT_IDS = 20;
const MAX_FILTERS = 10;
const COMMA_REPLACEMENT = 'PRESERVED_COMMA_HERE';
const aa = createArgumentsQueue('aa', 'aa.queue');
function isInitialized() {
  return !!copyFromWindow(INSIGHTS_OBJECT_NAME);
}
function replaceEscapedCommas(str) {
  while (str.indexOf('\\,') !== -1) {
    str = str.replace('\\,', COMMA_REPLACEMENT);
  }
  return str;
}
function replacePlaceholderText(str) {
  while (str.indexOf(COMMA_REPLACEMENT) !== -1) {
    str = str.replace(COMMA_REPLACEMENT, ',');
  }
  return str;
}
function splitPreservingEscapedCommas(str) {
  // GTM does not support regexes in custom templates, so we need to use straight text replacements instead
  return replaceEscapedCommas(str).split(',').map(replacePlaceholderText);
}
function formatValueToList(value) {
  if (isArray(value)) {
    return value;
  } else if (isNumber(value)) {
    return [value];
  } else if (isString(value)) {
    return splitPreservingEscapedCommas(value);
  } else {
    return [];
  }
}
function isArray(value) {
  return getType(value) === 'array';
}
function isNumber(value) {
  return getType(value) === 'number';
}
function isString(value) {
  return getType(value) === 'string';
}
function isObject(value) {
  return getType(value) === 'object';
}
function isNullOrUndefined(value) {
  const type = getType(value);
  return type === 'null' || type === 'undefined';
}
function transformObjectData(objectData) {
  if (isNullOrUndefined(objectData)) {
    return undefined;
  }
  if (!isArray(objectData)) {
    logger('objectData is not a list', objectData);
    return objectData;
  }
  return objectData.map((od) => {
    if (!isObject(od)) {
      logger('objectData list item is not an object', od);
      return od;
    }
    // The API expects price to be a number so delete it entirely if empty.
    if (isString(od.price) && od.price === '') {
      od.price = undefined;
    }
    // The API expects discount to be a number so delete it entirely if empty.
    if (isString(od.discount) && od.discount === '') {
      od.discount = undefined;
    }
    // The API expects quantity to be an integer.
    // If quantity is empty, then delete it entirely because the API allows
    // quantity to be omitted from the event payload.
    if (isString(od.quantity)) {
      if (od.quantity) {
        od.quantity = makeInteger(od.quantity);
      } else {
        od.quantity = undefined;
      }
    }
    return od;
  });
}
function getLibraryURL(useIIFE) {
  return (
    INSIGHTS_LIBRARY_URL +
    (useIIFE === true ? '/dist/search-insights.iife.min.js' : '')
  );
}
function logger(message, event) {
  log('[GTM-DEBUG] Search Insights > ' + message, event || '');
}
function shallowObjectClone(obj) {
  const keys = Object.keys(obj);
  const newObj = {};
  keys.forEach((key) => {
    newObj[key] = obj[key];
  });
  return newObj;
}
function chunkPayload(payload, keys, limit) {
  // Clean keys being undefined in the payload
  keys = keys.filter((key) => payload[key] !== undefined);
  // check if the values in `payload` for each of `keys` have the same length.
  const sameNumberOfValues = keys
    .map((k) => payload[k].length)
    .every((n) => n === payload[keys[0]].length);
  if (!sameNumberOfValues) {
    // chunking behavior is unsafe due to unequal length arrays to chunk.
    // bail out early.
    return [payload];
  }
  const numberOfChunks = Math.ceil(payload[keys[0]].length / limit);
  const chunks = [];
  for (let i = 0; i < numberOfChunks; i++) {
    const newPayload = shallowObjectClone(payload);
    keys.forEach((key) => {
      newPayload[key] = payload[key].slice(i * limit, (i + 1) * limit);
    });
    chunks.push(newPayload);
  }
  return chunks;
}
switch (data.method) {
  case 'init': {
    const pointer = copyFromWindow(INSIGHTS_OBJECT_NAME);
    if (pointer && pointer !== 'aa') {
      logger(
        'window.' +
          INSIGHTS_OBJECT_NAME +
          ' is "' +
          pointer +
          '", not "aa". This might cause issues if not using GTM to send events.'
      );
    }
    if (!isInitialized()) {
      const url = getLibraryURL(data.useIIFE);
      if (queryPermission('inject_script', url)) {
        injectScript(
          url,
          () => {
            if (!copyFromWindow('aa')) {
              data.gtmOnFailure();
              logger('[ERROR] Failed to load search-insights.');
              return;
            }
            let libraryLoaded = false;
            // call any method to see if it reacts.
            // `getUserToken` is synchronous, so it updates the flag immediately.
            aa('getUserToken', null, () => {
              libraryLoaded = true;
            });
            if (libraryLoaded) {
              data.gtmOnSuccess();
            } else {
              log(
                '[ERROR] Failed to load search-insights.\n\n' +
                  'If your website is using RequireJS, you need to turn on "Use IIFE" option of Initialization method.'
              );
              data.gtmOnFailure();
            }
          },
          data.gtmOnFailure,
          url
        );
      } else {
        logger(
          'The library endpoint is not allowed in the "Injects Scripts" permissions.\n\n' +
            'You need to add the value: "' +
            'https://cdn.jsdelivr.net/npm/search-insights*' +
            '"\n\n' +
            'See https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#step-4-modify-permissions'
        );
        data.gtmOnFailure();
        break;
      }
    } else {
      logger('[INFO] search-insights is already loaded.');
    }
    log(
      '[INFO] Algolia GTM template no longer validates event payloads.\nYou can visit https://algolia.com/events/debugger instead.'
    );
    const initOptions = {
      appId: data.appId,
      apiKey: data.apiKey,
      authenticatedUserToken: data.init_authenticatedUserToken,
      userHasOptedOut: data.userHasOptedOut,
      region: data.region,
      cookieDuration: data.cookieDuration,
      useCookie: data.useCookie !== false, // true by default
      host: data.host,
    };
    logger(data.method, initOptions);
    aa(data.method, initOptions);
    const userAgent = 'insights-gtm (1.7.1)';
    logger('addAlgoliaAgent', userAgent);
    aa('addAlgoliaAgent', userAgent);
    if (data.initialUserToken) {
      logger('setUserToken', data.initialUserToken);
      aa('setUserToken', data.initialUserToken);
    }
    setInWindow(INSIGHTS_OBJECT_NAME, 'aa');
    break;
  }
  case 'setAuthenticatedUserToken': {
    if (!isInitialized()) {
      logger('You need to call the "init" method first.');
      data.gtmOnFailure();
      break;
    }
    const token = data.setAuthenticatedUserToken_token || undefined;
    logger('setAuthenticatedUserToken', token);
    aa('setAuthenticatedUserToken', token);
    break;
  }
  case 'viewedObjectIDs': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'view',
      eventName: data.eventName,
      index: data.index,
      objectIDs: formatValueToList(data.objectIDs),
      objectData: transformObjectData(data.objectData),
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
    };
    const chunks = chunkPayload(
      payload,
      ['objectIDs', 'objectData'],
      MAX_OBJECT_IDS
    );
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'clickedObjectIDsAfterSearch': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'click',
      eventName: data.eventName,
      index: data.index,
      objectIDs: formatValueToList(data.objectIDs),
      objectData: transformObjectData(data.objectData),
      positions: formatValueToList(data.positions).map(makeInteger),
      queryID: data.queryID,
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
    };
    const chunks = chunkPayload(
      payload,
      ['objectIDs', 'objectData', 'positions'],
      MAX_OBJECT_IDS
    );
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'clickedObjectIDs': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'click',
      eventName: data.eventName,
      index: data.index,
      queryID: data.queryID,
      objectIDs: formatValueToList(data.objectIDs),
      objectData: transformObjectData(data.objectData),
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
    };
    const chunks = chunkPayload(
      payload,
      ['objectIDs', 'objectData'],
      MAX_OBJECT_IDS
    );
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'clickedFilters': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'click',
      eventName: data.eventName,
      filters: formatValueToList(data.filters),
      index: data.index,
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
    };
    const chunks = chunkPayload(payload, ['filters'], MAX_FILTERS);
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'convertedObjectIDsAfterSearch': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'conversion',
      eventName: data.eventName,
      index: data.index,
      objectIDs: formatValueToList(data.objectIDs),
      objectData: transformObjectData(data.objectData),
      queryID: data.queryID,
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
      value: data.value,
      currency: data.currency,
    };
    if (data.eventSubtype) {
      payload.eventSubtype = data.eventSubtype;
    }
    const chunks = chunkPayload(
      payload,
      ['objectIDs', 'objectData'],
      MAX_OBJECT_IDS
    );
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'convertedObjectIDs': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'conversion',
      eventName: data.eventName,
      index: data.index,
      objectIDs: formatValueToList(data.objectIDs),
      objectData: transformObjectData(data.objectData),
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
      value: data.value,
      currency: data.currency,
    };
    if (data.eventSubtype) {
      payload.eventSubtype = data.eventSubtype;
    }
    const chunks = chunkPayload(
      payload,
      ['objectIDs', 'objectData'],
      MAX_OBJECT_IDS
    );
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'convertedFilters': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'conversion',
      eventName: data.eventName,
      filters: formatValueToList(data.filters),
      index: data.index,
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
      value: data.value,
      currency: data.currency,
    };
    if (data.eventSubtype) {
      payload.eventSubtype = data.eventSubtype;
    }
    const chunks = chunkPayload(payload, ['filters'], MAX_FILTERS);
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  case 'viewedFilters': {
    if (!isInitialized()) {
      logger('You need to call the "init" event first.');
      data.gtmOnFailure();
      break;
    }
    const payload = {
      eventType: 'view',
      eventName: data.eventName,
      filters: formatValueToList(data.filters),
      index: data.index,
      userToken: data.userToken,
      authenticatedUserToken: data.authenticatedUserToken,
    };
    const chunks = chunkPayload(payload, ['filters'], MAX_FILTERS);
    logger('sendEvents', chunks);
    aa('sendEvents', chunks);
    data.gtmOnSuccess();
    break;
  }
  default: {
    logger('You need to set the method for this event.');
    data.gtmOnFailure();
  }
}


___TESTS___

scenarios:
- name: objectIds handles multiple ids
  code: |-
    const copyFromWindow = require('copyFromWindow');

    const mockData = {
      method: 'clickedObjectIDs',
      eventName: 'click',
      index: 'my-index',
      queryID: 'my-query-id',
      objectIDs: 'foo,bar,baz',
      objectData: [],
      userToken: 'my-user-token',
      authenticatedUserToken: 'my-authenticated-user-token'
    };

    runCode(mockData);

    const aa = copyFromWindow('aa');

    assertThat(aa.queue[aa.queue.length-1]).isEqualTo(['sendEvents', [{
      eventType: 'click',
      eventName: 'click',
      index: 'my-index',
      queryID: 'my-query-id',
      objectIDs: ['foo','bar','baz'],
      objectData: [],
      userToken: 'my-user-token',
      authenticatedUserToken: 'my-authenticated-user-token'
    }]]);
- name: objectIds handles multiple ids that contain commas
  code: |-
    const copyFromWindow = require('copyFromWindow');

    const mockData = {
      method: 'clickedObjectIDs',
      eventName: 'click',
      index: 'my-index',
      queryID: 'my-query-id',
      objectIDs: 'foo\\,bar,ba\\z,with\\,multiple\\,commas',
      objectData: [],
      userToken: 'my-user-token',
      authenticatedUserToken: 'my-authenticated-user-token'
    };

    runCode(mockData);

    const aa = copyFromWindow('aa');

    assertThat(aa.queue[aa.queue.length-1]).isEqualTo(['sendEvents', [{
      eventType: 'click',
      eventName: 'click',
      index: 'my-index',
      queryID: 'my-query-id',
      objectIDs: ['foo,bar','ba\\z', 'with,multiple,commas'],
      objectData: [],
      userToken: 'my-user-token',
      authenticatedUserToken: 'my-authenticated-user-token'
    }]]);
setup: |-
  const setInWindow = require('setInWindow');

  const INSIGHTS_OBJECT_NAME = 'AlgoliaAnalyticsObject';

  setInWindow(INSIGHTS_OBJECT_NAME, 'aa'); // isInitialized() will return true
